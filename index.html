<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Labtech Bonus Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
  </style>
</head>
<body class="p-6">
  <div class="max-w-6xl mx-auto">
    <div class="bg-white rounded-2xl shadow-2xl p-8">
      <h1 class="text-4xl font-bold text-center mb-2 bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
        ğŸ’¸ Labtech Bonus Calculator
      </h1>
      <p class="text-center text-gray-600 mb-8">Automatically calculate cascading tier bonuses with custom rules</p>
      
      <!-- Bonus Configuration -->
      <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-xl p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">âš™ï¸ Bonus Configuration</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ¥‡ Tier 1 Bonus</label>
            <input id="tier1Bonus" type="number" value="110000" class="w-full px-4 py-2 border-2 border-purple-300 rounded-lg focus:border-purple-500 focus:outline-none">
            <div class="text-xs text-gray-600 mt-1">
              <input id="tier1Cap" type="number" value="16" class="w-16 px-2 py-1 border rounded"> Captchas + 
              <input id="tier1Del" type="number" value="7" class="w-16 px-2 py-1 border rounded"> Deliveries
            </div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ¥ˆ Tier 2 Bonus</label>
            <input id="tier2Bonus" type="number" value="60000" class="w-full px-4 py-2 border-2 border-blue-300 rounded-lg focus:border-blue-500 focus:outline-none">
            <div class="text-xs text-gray-600 mt-1">
              <input id="tier2Cap" type="number" value="8" class="w-16 px-2 py-1 border rounded"> Captchas + 
              <input id="tier2Del" type="number" value="4" class="w-16 px-2 py-1 border rounded"> Deliveries
            </div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ¥‰ Tier 3 Bonus</label>
            <input id="tier3Bonus" type="number" value="40000" class="w-full px-4 py-2 border-2 border-orange-300 rounded-lg focus:border-orange-500 focus:outline-none">
            <div class="text-xs text-gray-600 mt-1">
              <input id="tier3Cap" type="number" value="6" class="w-16 px-2 py-1 border rounded"> Captchas + 
              <input id="tier3Del" type="number" value="3" class="w-16 px-2 py-1 border rounded"> Deliveries
            </div>
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">ğŸ’° Base Rates</label>
            <div class="space-y-2">
              <div>
                <span class="text-xs text-gray-600">Per Captcha: $</span>
                <input id="baseCap" type="number" value="4000" class="w-24 px-2 py-1 border-2 border-green-300 rounded focus:border-green-500 focus:outline-none">
              </div>
              <div>
                <span class="text-xs text-gray-600">Per Delivery: $</span>
                <input id="baseDel" type="number" value="5000" class="w-24 px-2 py-1 border-2 border-green-300 rounded focus:border-green-500 focus:outline-none">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Discord Settings -->
      <div class="bg-gray-50 rounded-xl p-6 mb-6">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ“ Discord Settings</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Role Mentions</label>
            <input id="roles" value="<@&914800296679583784> <@&889769208567705630>" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Your Mention ID</label>
            <input id="author" value="<@851784213707358218>" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Date Title</label>
            <input id="dateTitle" value="22nd October Bonuses" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
          </div>
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">Header Title</label>
            <input id="headerTitle" value="Daily Bonus" class="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none">
          </div>
        </div>
      </div>

      <!-- Input Data -->
      <div class="mb-6">
        <label class="block text-xl font-bold text-gray-800 mb-3">ğŸ“‹ Paste Raw Activity Data</label>
        <textarea id="raw" rows="10" placeholder="Examples:
766208029867507722 - 3 Cap 1 deli
197381046172516352 - Captchas Completed: 20 Deliveries Made: 11
927033962478579712 - 10 cap 5 deli" 
        class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none font-mono text-sm"></textarea>
      </div>

      <!-- Buttons -->
      <div class="flex gap-4 mb-6">
        <button onclick="generate()" class="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 text-white font-bold py-4 px-6 rounded-lg hover:from-purple-700 hover:to-blue-700 transition-all shadow-lg transform hover:scale-105">
          ğŸš€ Generate Markdown
        </button>
        <button onclick="copyOut()" class="flex-1 bg-gradient-to-r from-green-500 to-teal-500 text-white font-bold py-4 px-6 rounded-lg hover:from-green-600 hover:to-teal-600 transition-all shadow-lg transform hover:scale-105">
          ğŸ“‹ Copy to Clipboard
        </button>
        <button onclick="clearAll()" class="bg-red-500 text-white font-bold py-4 px-6 rounded-lg hover:bg-red-600 transition-all shadow-lg">
          ğŸ—‘ï¸ Clear
        </button>
      </div>

      <!-- Output -->
      <div>
        <div class="flex justify-between items-center mb-3">
          <label class="text-xl font-bold text-gray-800">ğŸ“¤ Generated Markdown Output</label>
          <span id="status" class="text-sm font-semibold"></span>
        </div>
        <pre id="out" class="bg-gray-900 text-green-400 p-6 rounded-lg overflow-auto max-h-96 font-mono text-sm whitespace-pre-wrap"></pre>
      </div>
    </div>
  </div>

<script>
function parseLine(line){
  const s = line.trim().toLowerCase();
  if(!s) return null;
  
  const hyphenIdx = s.indexOf('-');
  if(hyphenIdx === -1) return null;
  
  const id = s.slice(0, hyphenIdx).trim();
  const rest = s.slice(hyphenIdx+1);

  // Pattern 1: "x cap y deli"
  let m1 = rest.match(/(\d+)\s*cap[^0-9]*(\d+)\s*del/i);
  if(m1) return { id, caps: parseInt(m1[1]), dels: parseInt(m1[2]) };
  
  // Pattern 2: "Captchas Completed: X Deliveries Made : Y"
  let m2 = rest.match(/captchas\s*completed\s*:\s*(\d+)[^\d]+deliveries\s*made\s*:?\s*(\d+)/i);
  if(m2) return { id, caps: parseInt(m2[1]), dels: parseInt(m2[2]) };
  
  // Pattern 3: any two numbers
  let m3 = rest.match(/(\d+)\D+(\d+)/);
  if(m3) return { id, caps: parseInt(m3[1]), dels: parseInt(m3[2]) };
  
  return null;
}

function cascade(caps, dels){
  const tier1Bonus = parseInt(document.getElementById('tier1Bonus').value) || 110000;
  const tier1Cap = parseInt(document.getElementById('tier1Cap').value) || 16;
  const tier1Del = parseInt(document.getElementById('tier1Del').value) || 7;
  
  const tier2Bonus = parseInt(document.getElementById('tier2Bonus').value) || 60000;
  const tier2Cap = parseInt(document.getElementById('tier2Cap').value) || 8;
  const tier2Del = parseInt(document.getElementById('tier2Del').value) || 4;
  
  const tier3Bonus = parseInt(document.getElementById('tier3Bonus').value) || 40000;
  const tier3Cap = parseInt(document.getElementById('tier3Cap').value) || 6;
  const tier3Del = parseInt(document.getElementById('tier3Del').value) || 3;
  
  const baseCap = parseInt(document.getElementById('baseCap').value) || 4000;
  const baseDel = parseInt(document.getElementById('baseDel').value) || 5000;

  let rc = caps, rd = dels, parts = [], total = 0;

  // Apply Tier 1
  while(rc >= tier1Cap && rd >= tier1Del){
    parts.push(`ğŸ¥‡ **Tier 1 Bonus â€” $${tier1Bonus.toLocaleString()}** ğŸ¥‡`);
    total += tier1Bonus;
    rc -= tier1Cap;
    rd -= tier1Del;
  }
  
  // Apply Tier 2
  while(rc >= tier2Cap && rd >= tier2Del){
    parts.push(`ğŸ¥ˆ **Tier 2 Bonus â€” $${tier2Bonus.toLocaleString()}** ğŸ¥ˆ`);
    total += tier2Bonus;
    rc -= tier2Cap;
    rd -= tier2Del;
  }
  
  // Apply Tier 3
  while(rc >= tier3Cap && rd >= tier3Del){
    parts.push(`ğŸ¥‰ **Tier 3 Bonus â€” $${tier3Bonus.toLocaleString()}** ğŸ¥‰`);
    total += tier3Bonus;
    rc -= tier3Cap;
    rd -= tier3Del;
  }

  // Base bonus
  if(rc > 0){
    parts.push(`(${rc} Captchas Ã— $${baseCap.toLocaleString()} = $${(rc*baseCap).toLocaleString()})`);
    total += rc * baseCap;
  }
  if(rd > 0){
    parts.push(`(${rd} Deliveries Ã— $${baseDel.toLocaleString()} = $${(rd*baseDel).toLocaleString()})`);
    total += rd * baseDel;
  }

  return { parts, total };
}

function generate(){
  const raw = document.getElementById('raw').value.split('\n');
  const roles = document.getElementById('roles').value || '';
  const author = document.getElementById('author').value || '';
  const dateTitle = document.getElementById('dateTitle').value || 'Bonuses';
  const headerTitle = document.getElementById('headerTitle').value || 'Daily Bonus';
  
  const baseCap = parseInt(document.getElementById('baseCap').value) || 4000;
  const baseDel = parseInt(document.getElementById('baseDel').value) || 5000;

  const order = [];
  const sum = {};
  
  for(const line of raw){
    const p = parseLine(line);
    if(!p) continue;
    if(!sum[p.id]){
      sum[p.id] = { caps:0, dels:0 };
      order.push(p.id);
    }
    sum[p.id].caps += p.caps;
    sum[p.id].dels += p.dels;
  }

  let md = [];
  md.push(`# ğŸ’¸ ${headerTitle} For ${roles} ğŸ’¸  `);
  md.push(`# ğŸ“† ${dateTitle}`);
  md.push('');
  md.push('==================================================================');
  md.push('');

  let grand = 0;
  for(const id of order){
    const caps = sum[id].caps;
    const dels = sum[id].dels;
    const { parts, total } = cascade(caps, dels);
    grand += total;
    
    md.push(`<@${id}> â€” (${caps} Captchas + ${dels} Deliveries)  `);
    if(parts.some(x => x.includes('Tier'))){
      for(const part of parts){
        md.push(part + '  ');
      }
      md.push(`**= $${total.toLocaleString()}**`);
    }else{
      const capB = caps * baseCap;
      const delB = dels * baseDel;
      md.push(`**$${capB.toLocaleString()} + $${delB.toLocaleString()} = $${(capB+delB).toLocaleString()}**`);
    }
    md.push('');
  }

  md.push('==================================================================  ');
  md.push(`ğŸ’¸ **Final Total: $${grand.toLocaleString()}** ğŸ’¸ ${author}  `);
  md.push('ğŸ“© **Bonus missing?** DM me with logs or bodycam proof');

  document.getElementById('out').textContent = md.join('\n');
  document.getElementById('status').textContent = 'âœ… Generated successfully!';
  document.getElementById('status').className = 'text-sm font-semibold text-green-600';
  
  setTimeout(() => {
    document.getElementById('status').textContent = '';
  }, 3000);
}

function copyOut(){
  const txt = document.getElementById('out').textContent;
  if(!txt){
    alert('âš ï¸ Generate markdown first!');
    return;
  }
  navigator.clipboard.writeText(txt).then(() => {
    document.getElementById('status').textContent = 'âœ… Copied to clipboard!';
    document.getElementById('status').className = 'text-sm font-semibold text-green-600';
    setTimeout(() => {
      document.getElementById('status').textContent = '';
    }, 3000);
  });
}

function clearAll(){
  document.getElementById('raw').value = '';
  document.getElementById('out').textContent = '';
  document.getElementById('status').textContent = 'ğŸ—‘ï¸ Cleared!';
  document.getElementById('status').className = 'text-sm font-semibold text-red-600';
  setTimeout(() => {
    document.getElementById('status').textContent = '';
  }, 2000);
}
</script>
</body>
</html>
